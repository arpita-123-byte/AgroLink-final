<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sell Crops | AgroLink</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style2.css" />
  <!-- Floating Chat Icon -->
<style>
  #chat-icon {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #28a745;
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    z-index: 999;
  }

  #chat-box {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 300px;
    height: 400px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    display: none;
    flex-direction: column;
    z-index: 999;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
  }

  #chat-input {
    display: flex;
    border-top: 1px solid #ccc;
  }

  #chat-input input {
    flex: 1;
    border: none;
    padding: 10px;
  }

  #chat-input button {
    border: none;
    background: #28a745;
    color: white;
    padding: 0 15px;
  }
</style>
</head>
<body>
  <!-- Navbar -->
<!-- Bootstrap Navbar with Beautiful Profile Dropdown -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold text-success" href="index.html">AgroLink</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
      data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-center">
        <!-- <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li> -->
        <!-- <li class="nav-item"><a class="nav-link" href="crops.html">Browse Crops</a></li> -->
        <li class="nav-item"><a class="nav-link" href="sell.html">Sell Crops</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
        <li class="nav-item"><a class="btn btn-success ms-3" href="register.html">Join</a></li>

        <!-- Cart -->
        <!-- <li class="nav-item ms-3"> -->
          <!-- <a class="nav-link position-relative" href="cart.html"> -->
            <!-- üõí Cart -->
            <!-- <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span> -->
          <!-- </a> -->
        <!-- </li> -->

        <!-- üåü Beautiful Profile Dropdown -->
    
<!-- Profile Dropdown (with human-style avatar) -->
<!-- Profile Dropdown (Myntra-style with avatar) -->
<!-- <li class="nav-item dropdown ms-3">
  <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="profileDropdown"
     role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <img src="https://i.ibb.co/ZYW3VTp/boy-avatar.png"
         alt="Profile Picture" width="36" height="36" class="rounded-circle border border-2 shadow-sm" />
    <span class="fw-semibold text-dark">Profile</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end shadow profile-dropdown" aria-labelledby="profileDropdown">
    <li class="px-3 py-3 border-bottom">
      <p class="mb-0 fw-bold">Hello, Arpita üëã</p>
      <p class="mb-0 text-muted small">View & edit profile</p>
    </li>
    <li><a class="dropdown-item py-2" href="order-status.html">üßæ My Orders</a></li>
    <li><a class="dropdown-item py-2" href="#">‚ù§Ô∏è Wishlist</a></li>
    <li><a class="dropdown-item py-2" href="#">üéÅ Gift Cards</a></li>
    <li><a class="dropdown-item py-2" href="contact.html">üìû Contact Us</a></li>
    <li><a class="dropdown-item py-2" href="#">üåü Subscription</a></li>
    
    <li><a class="dropdown-item py-2" href="#">üè∑Ô∏è Coupons</a></li>
    <li><a class="dropdown-item py-2" href="#">üíº Saved Cards</a></li>
    <li><a class="dropdown-item py-2" href="#">üè¶ Saved VPA</a></li>
    <li><a class="dropdown-item py-2" href="#">üè† Saved Addresses</a></li>
  </ul>
</li> -->



        <!-- End Profile Dropdown -->
      </ul>
      <button class="logout-btn" onclick="logout()">Logout</button>

<script>
  function logout() {
    fetch('/logout')
      .then(() => window.location.href = '/login.html')
      .catch(err => alert("Logout failed"));
  }
</script>
      
    </div>
  </div>
  
  
</nav>


  <!-- Crop Listing Form -->
 <!-- Crop Listing Form -->
<section class="form-hero">
  <div class="form-overlay d-flex align-items-center">
    <div class="container">
      <h2 class="text-center mb-4 text-white">List Your Crop for Sale</h2>
  <!-- ‚úÖ Corrected Form -->
<form id="cropForm" enctype="multipart/form-data" method="POST" class="bg-white p-4 rounded shadow">
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Crop Name</label>
      <input type="text" class="form-control" name="name" required />
    </div>

    <div class="col-md-6">
      <label class="form-label">Category</label>
      <select class="form-select" name="category" required>
        <option value="">Select Category</option>
        <option value="Fruits">Fruits</option>
        <option value="Vegetables">Vegetables</option>
        <option value="Grains">Grains</option>
        <option value="Spices">Spices</option>
      </select>
    </div>

    <div class="col-md-6">
      <label class="form-label">Price (in ‚Çπ)</label>
      <input type="number" class="form-control" name="price" required />
    </div>

    <div class="col-md-6">
      <label class="form-label">Quantity (e.g., 10 kg, 2 quintals)</label>
      <input type="text" class="form-control" name="quantity" required />
    </div>

    <div class="col-md-12">
      <label class="form-label">Location</label>
      <input type="text" class="form-control" name="location" required />
    </div>
     <div class="col-md-12">
      <label class="form-label">E-mail</label>
      <input type="email" class="form-control" name="sellerEmail" required />
    </div>


    <div class="col-md-12">
      <label class="form-label">Description</label>
      <textarea class="form-control" rows="3" name="description" required></textarea>
    </div>

    <div class="col-md-12">
      <label class="form-label">Upload Image</label>
      <input type="file" class="form-control" name="image" accept="image/*" required />
    </div>

    <div class="col-12 text-center">
      <button type="submit" class="btn btn-success mt-3">Submit Crop Listing</button>
    </div>
  </div>
</form>


      <!-- Move this message DIV inside the container but OUTSIDE the form -->
      <div class="mt-4 text-center" id="message"></div>
    </div>
  </div>
</section>
<div id="chat-icon">üí¨</div>

<div id="chat-box">
  <div id="chat-messages"></div>
  <div id="chat-input">
    <input type="text" placeholder="Type a message..." id="messageInput">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>




<script src="js/sell.js"></script>
<script src="js/fetchCrops.js"></script>
<script>
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const count = cart.reduce((total, item) => total + item.quantity, 0);
    const badge = document.getElementById("cart-count");
    if (badge) badge.textContent = count;
  }

  updateCartCount();
</script>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
  const socket = io();

const username = sessionStorage.getItem("userEmail") || "Guest";
const role = sessionStorage.getItem("userRole") || "User";
const chatMessages = document.getElementById("chat-messages");
const messageInput = document.getElementById("messageInput");

document.getElementById("chat-icon").addEventListener("click", () => {
  const chatBox = document.getElementById("chat-box");
  chatBox.style.display = chatBox.style.display === "none" ? "flex" : "none";
});

function sendMessage() {
  const msg = messageInput.value.trim();
  if (!msg) return;
  socket.emit("chat message", { sender: username, role, text: msg });
  messageInput.value = "";
}

 //  Login/Logout Handling
    const loginLink = document.getElementById("loginLink");
    const joinBtn = document.getElementById("joinBtn");
    const isLoggedIn = sessionStorage.getItem("isLoggedIn");

    if (isLoggedIn === "true") {
      loginLink.textContent = "Logout";
      loginLink.href = "#";
      loginLink.addEventListener("click", () => {
        sessionStorage.clear();
        location.reload();
      });
      if (joinBtn) joinBtn.style.display = "none";
    }

socket.on("chat message", (msg) => {
  const msgDiv = document.createElement("div");
  msgDiv.className = msg.sender === username ? "text-end text-success" : "text-start text-primary";
  msgDiv.textContent = `${msg.role || "User"}: ${msg.text}`;
  chatMessages.appendChild(msgDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;


});

</script>



</body>
</html>
